<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Compile kernel in Android without PC | fossfrog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Compile kernel in Android without PC" />
<meta name="author" content="Shubham Vishwakarma" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Most of the time I use my laptop that has a dual core celeron processor, which isn’t good in kernel compilation. So, I use Google cloud to compile kernels. Google cloud provides free 50 hours/week, which is more than enough to compile multiple kernels. The only thing you need is a google account. You can use Google cloud in your phone, without PC/Laptop. One more thing, you can follow the below tutorial to build in your PC as well, just skip first step. (-;" />
<meta property="og:description" content="Most of the time I use my laptop that has a dual core celeron processor, which isn’t good in kernel compilation. So, I use Google cloud to compile kernels. Google cloud provides free 50 hours/week, which is more than enough to compile multiple kernels. The only thing you need is a google account. You can use Google cloud in your phone, without PC/Laptop. One more thing, you can follow the below tutorial to build in your PC as well, just skip first step. (-;" />
<link rel="canonical" href="/kernel/2023/10/30/compile-kernel-in-android-without-pc.html" />
<meta property="og:url" content="/kernel/2023/10/30/compile-kernel-in-android-without-pc.html" />
<meta property="og:site_name" content="fossfrog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-30T16:58:12+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Compile kernel in Android without PC" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Shubham Vishwakarma"},"dateModified":"2023-10-30T16:58:12+05:30","datePublished":"2023-10-30T16:58:12+05:30","description":"Most of the time I use my laptop that has a dual core celeron processor, which isn’t good in kernel compilation. So, I use Google cloud to compile kernels. Google cloud provides free 50 hours/week, which is more than enough to compile multiple kernels. The only thing you need is a google account. You can use Google cloud in your phone, without PC/Laptop. One more thing, you can follow the below tutorial to build in your PC as well, just skip first step. (-;","headline":"Compile kernel in Android without PC","mainEntityOfPage":{"@type":"WebPage","@id":"/kernel/2023/10/30/compile-kernel-in-android-without-pc.html"},"url":"/kernel/2023/10/30/compile-kernel-in-android-without-pc.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="fossfrog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">fossfrog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Compile kernel in Android without PC</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-10-30T16:58:12+05:30" itemprop="datePublished">Oct 30, 2023
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Shubham Vishwakarma</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><span style="font-size: 40px">M</span>ost of the time I use my laptop that has a dual core celeron processor, which isn’t good in kernel compilation. So, I use Google cloud to compile kernels. Google cloud provides free 50 hours/week, which is more than enough to compile multiple kernels. The only thing you need is a google account. You can use Google cloud in your phone, without PC/Laptop. One more thing, you can follow the below tutorial to build in your PC as well, just skip first step. (-;</p>

<h4 id="1-open-google-cloud-console">1. <u><b>Open Google Cloud Console</b></u></h4>
<ul>
  <li>Go to <a href="https://cloud.google.com">cloud.google.com</a>.</li>
  <li>Login with your google account.</li>
  <li>Click on “Console” at top-right corner.</li>
  <li>After clicking on “Console” you’ll see a terminal icon on top-right corner. Click on that icon.</li>
  <li>Now, a terminal will appear on the webpage. Here we’ll do our kernel compilation.</li>
</ul>

<h4 id="2-setup-build-environment">2. <u><b>Setup Build Environment</b></u></h4>
<p>Once you get the console, install necessary packages, toolchains and kernel source. You can download the toolchains from my repo or download according to your device.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Install necessary packages/libs</span>
<span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt upgrade <span class="nt">-y</span>
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> gcc-aarch64-linux-gnu build-essential libncurses-dev <span class="se">\</span>
libssl-dev flex bc git curl wget unzip python3 python-is-python3</code></pre></figure>

<h4 id="3-download-toolchains-and-kernel-source">3. <u><b>Download Toolchains and Kernel Source</b></u></h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Example: LineageOS kernel for OnePlus3</span>
<span class="c"># Create tmp directory and download source and toolchains</span>
<span class="nb">mkdir </span>tmp <span class="o">&amp;&amp;</span> <span class="nb">cd </span>tmp
wget https://github.com/Shubhamvis98/toolchains/archive/refs/heads/master.zip <span class="nt">-O</span> tc.zip <span class="o">&amp;&amp;</span> unzip <span class="nt">-q</span> tc.zip <span class="o">&amp;&amp;</span> <span class="nb">rm </span>tc.zip
wget https://github.com/LineageOS/android_kernel_oneplus_msm8996/archive/refs/heads/lineage-18.1.zip <span class="nt">-O</span> k.zip <span class="o">&amp;&amp;</span> unzip <span class="nt">-q</span> k.zip <span class="o">&amp;&amp;</span> <span class="nb">rm </span>k.zip
<span class="c"># The above commands will download, unzip and delete the zip files.</span>

<span class="c"># After above steps you'll get two directories, toolchains and kernel source directory:</span>
android_kernel_oneplus_msm8996-lineage-18.1 toolchains-master</code></pre></figure>

<h4 id="4-setup-exports-and-aliases">4. <u><b>Setup Exports and Aliases</b></u></h4>
<p>The below code block is all you need if you want to compile with CLANG or GCC.
I’ve created two aliases for make command. You can adjust the parameters according to your need.</p>

<p>If you want to compile with CLANG, use <code class="language-plaintext highlighter-rouge">makecl</code> and to build with GCC, use <code class="language-plaintext highlighter-rouge">make</code> command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">TC</span><span class="o">=</span>~/tmp/toolchains-master
<span class="nv">GCC</span><span class="o">=</span><span class="nv">$TC</span>/aarch64-linux-android-4.9/bin
<span class="nv">GCC32</span><span class="o">=</span><span class="nv">$TC</span>/arm-linux-androideabi-4.9/bin
<span class="nv">CLANG</span><span class="o">=</span><span class="nv">$TC</span>/clang-r428724/bin

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$CLANG</span>:<span class="nv">$GCC</span>:<span class="nv">$GCC32</span>:<span class="nv">$PATH</span>
<span class="nb">export </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-linux-android-
<span class="nb">export </span><span class="nv">CROSS_COMPILE_ARM32</span><span class="o">=</span>arm-linux-androideabi-
<span class="nb">export </span><span class="nv">CLANG_TRIPLE</span><span class="o">=</span>aarch64-linux-gnu-

<span class="nv">DEFCONFIG</span><span class="o">=</span>lineageos_oneplus3_defconfig
<span class="nb">export </span><span class="nv">ARCH</span><span class="o">=</span>arm64

<span class="nb">alias </span><span class="nv">makecl</span><span class="o">=</span><span class="s2">"make CC=clang O=output"</span>
<span class="nb">alias </span><span class="nv">make</span><span class="o">=</span><span class="s2">"make O=output"</span></code></pre></figure>

<h4 id="5-lets-build">5. <u><b>Let's Build...</b></u></h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># cd to kernel source</span>
<span class="nb">cd</span> ~/tmp/android_kernel_oneplus_msm8996-lineage-18.1

<span class="c"># To build with GCC</span>
make <span class="nv">$DEFCONFIG</span>
make menuconfig
make

<span class="c"># To build with CLANG</span>
makecl <span class="nv">$DEFCONFIG</span>
makecl menuconfig
makecl</code></pre></figure>

<h4 id="6-get-the-kernel-and-dtbs">6. <u><b>Get the kernel and dtbs</b></u></h4>
<p>After compilation, you can download the kernel and necessary dtbs to your local machine/phone to make boot.img.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir</span> ~/tmp/out
<span class="nb">cp </span>output/arch/arm<span class="k">*</span>/boot/Image<span class="k">*</span> ~/tmp/out
<span class="c"># If your device has separate dtb from kernel then you need the dtb files as well to flash in dtb partition</span>
<span class="nb">mkdir</span> ~/tmp/out/dtbs
find output <span class="nt">-name</span> <span class="s1">'*.dtb*'</span> <span class="nt">-exec</span> <span class="nb">cp</span> <span class="o">{}</span> ~/tmp/out/dtbs <span class="se">\;</span>

<span class="c"># Compress kernel and dtbs and download to local</span>
<span class="nb">cd</span> ~/tmp
<span class="nb">tar</span> <span class="nt">-cpzf</span> build.tgz out <span class="c"># this will create a build.tgz archive</span></code></pre></figure>

<p>Now download the kernel to your local by clicking on “the three dots on top left corner -&gt; Download”</p>

<h4 id="7-create-bootimg">7. <u><b>Create boot.img</b></u></h4>
<ul>
  <li>Clone or download <a href="https://github.com/ShubhamVis98/AIK">Android Image Kitchen</a> from my repo.</li>
  <li>Get your stock boot.img and run <code class="language-plaintext highlighter-rouge">./unpackimg boot.img</code> to unpack the stock boot image.</li>
  <li>After that you’ll see the aik will create a directory named <code class="language-plaintext highlighter-rouge">split</code> with unpacked kernel and dtb.</li>
  <li>Extract the downloaded <code class="language-plaintext highlighter-rouge">build.tgz</code> archive using <code class="language-plaintext highlighter-rouge">tar -xpf build.tgz</code> and replace the kernel in split directory.</li>
  <li>Now repack the boot.img using <code class="language-plaintext highlighter-rouge">./repackimg</code>. This will create a new image in aik directory.</li>
</ul>

<h4 id="now-you-can-bootflash-your-new-boot-image-using-fastboot-or-from-recovery">Now you can boot/flash your new boot image using fastboot or from recovery.</h4>
<h4 id="note"><u><b>NOTE:</b></u></h4>
<ul>
  <li>Try booting before flashing the boot image.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">fastboot boot new-boot.img</code></li>
    </ul>
  </li>
  <li>if everything works as expected, then you can flash it.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">fastboot flash new-boot.img</code></li>
    </ul>
  </li>
  <li><strong>Always backup your original/stock boot image.</strong></li>
  <li><strong>Try to avoid using multiple cores and continuous kernel compilation in google cloud otherwise google will ban cloud access to your account. Don’t worry, your gmail, drive and other apps will work.</strong></li>
</ul>


  </div><a class="u-url" href="/kernel/2023/10/30/compile-kernel-in-android-without-pc.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">fossfrog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">fossfrog</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.twitter.com/shubhamvis98"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">shubhamvis98</span></a></li><li><a href="https://youtube.com/fossfrog"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#youtube"></use></svg> <span class="username">fossfrog</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
